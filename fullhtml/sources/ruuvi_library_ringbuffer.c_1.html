
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>ruuvi_library_ringbuffer.c</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.5.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">#include &quot;ruuvi_library.h&quot;</a>
<a name="ln2">#include &quot;ruuvi_library_ringbuffer.h&quot;</a>
<a name="ln3">#include &lt;string.h&gt;</a>
<a name="ln4"> </a>
<a name="ln5"> </a>
<a name="ln6">rl_status_t rl_ringbuffer_queue (rl_ringbuffer_t * const buffer,</a>
<a name="ln7">                                 const void * const data,</a>
<a name="ln8">                                 const size_t data_length)</a>
<a name="ln9">{</a>
<a name="ln10">    if (NULL == buffer || NULL == data)         { return RL_ERROR_NULL; }</a>
<a name="ln11"> </a>
<a name="ln12">    if (rl_ringbuffer_full (buffer))  { return RL_ERROR_NO_MEM; }</a>
<a name="ln13"> </a>
<a name="ln14">    if (buffer-&gt;block_size &lt; data_length)       { return RL_ERROR_DATA_LENGTH; }</a>
<a name="ln15"> </a>
<a name="ln16">    if (!buffer-&gt;lock (buffer-&gt;writelock, true)) { return RL_ERROR_CONCURRENCY; }</a>
<a name="ln17"> </a>
<a name="ln18">    memcpy ( (buffer-&gt;storage) + (buffer-&gt;head * buffer-&gt;block_size),</a>
<a name="ln19">             data, data_length);</a>
<a name="ln20">    buffer-&gt;head = ( (buffer-&gt;head + 1) &amp; buffer-&gt;index_mask);</a>
<a name="ln21"> </a>
<a name="ln22">    if (!buffer-&gt;lock (buffer-&gt;writelock, false)) { return RL_ERROR_FATAL; }</a>
<a name="ln23"> </a>
<a name="ln24">    return RL_SUCCESS;</a>
<a name="ln25">}</a>
<a name="ln26"> </a>
<a name="ln27">rl_status_t rl_ringbuffer_dequeue (rl_ringbuffer_t * const buffer,</a>
<a name="ln28">                                   void * const data)</a>
<a name="ln29">{</a>
<a name="ln30">    rl_status_t err_code = RL_SUCCESS;</a>
<a name="ln31"> </a>
<a name="ln32">    if (NULL == buffer || NULL == data)</a>
<a name="ln33">    {</a>
<a name="ln34">        err_code |= RL_ERROR_NULL;</a>
<a name="ln35">    }</a>
<a name="ln36">    else if (rl_ringbuffer_empty (buffer))</a>
<a name="ln37">    {</a>
<a name="ln38">        err_code |= RL_ERROR_NO_DATA;</a>
<a name="ln39">    }</a>
<a name="ln40">    else if (!buffer-&gt;lock (buffer-&gt;readlock, true))</a>
<a name="ln41">    {</a>
<a name="ln42">        err_code |= RL_ERROR_CONCURRENCY;</a>
<a name="ln43">    }</a>
<a name="ln44">    else</a>
<a name="ln45">    {</a>
<a name="ln46">        void ** p_data = (void **) data;</a>
<a name="ln47">        *p_data = buffer-&gt;storage + (buffer-&gt;tail * buffer-&gt;block_size);</a>
<a name="ln48">        buffer-&gt;tail = ( (buffer-&gt;tail + 1) &amp; buffer-&gt;index_mask);</a>
<a name="ln49"> </a>
<a name="ln50">        if (!buffer-&gt;lock (buffer-&gt;readlock, false))</a>
<a name="ln51">        {</a>
<a name="ln52">            err_code |= RL_ERROR_FATAL;</a>
<a name="ln53">        }</a>
<a name="ln54">    }</a>
<a name="ln55"> </a>
<a name="ln56">    return err_code;</a>
<a name="ln57">}</a>
<a name="ln58"> </a>
<a name="ln59">rl_status_t rl_ringbuffer_peek (rl_ringbuffer_t * const</a>
<a name="ln60">                                buffer,</a>
<a name="ln61">                                const void * data, const size_t index)</a>
<a name="ln62">{</a>
<a name="ln63">    if (NULL == buffer || NULL == data)         { return RL_ERROR_NULL; }</a>
<a name="ln64"> </a>
<a name="ln65">    if ( ( (buffer-&gt;tail + index) &amp; buffer-&gt;index_mask) == buffer-&gt;head)</a>
<a name="ln66">    {</a>
<a name="ln67">        return RL_ERROR_NO_DATA;</a>
<a name="ln68">    }</a>
<a name="ln69"> </a>
<a name="ln70">    if (!buffer-&gt;lock (buffer-&gt;readlock, true))  {return RL_ERROR_CONCURRENCY; }</a>
<a name="ln71"> </a>
<a name="ln72">    void ** p_data = (void **) data;</a>
<a name="ln73">    *p_data = buffer-&gt;storage + ( ( (buffer-&gt;tail + index) &amp; buffer-&gt;index_mask) *</a>
<a name="ln74">                                  buffer-&gt;block_size);</a>
<a name="ln75"> </a>
<a name="ln76">    if (!buffer-&gt;lock (buffer-&gt;readlock, false)) {return RL_ERROR_FATAL; }</a>
<a name="ln77"> </a>
<a name="ln78">    return RL_SUCCESS;</a>
<a name="ln79">}</a>
<a name="ln80"> </a>
<a name="ln81">bool rl_ringbuffer_full (const rl_ringbuffer_t * const buffer)</a>
<a name="ln82">{</a>
<a name="ln83">    return ( (buffer-&gt;head - buffer-&gt;tail) &amp; buffer-&gt;index_mask) == buffer-&gt;index_mask;</a>
<a name="ln84">}</a>
<a name="ln85"> </a>
<a name="ln86">bool rl_ringbuffer_empty (const rl_ringbuffer_t * const buffer)</a>
<a name="ln87">{</a>
<a name="ln88">    return buffer-&gt;head == buffer-&gt;tail;</a>
<a name="ln89">}</a>

</code></pre>
<div class="balloon" rel="18"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2562/" target="_blank">V2562</a> Expressions with pointer type should not be used in the '+', '-', '+=' and '-=' operations.</p></div>
<div class="balloon" rel="20"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2568/" target="_blank">V2568</a> Both operands of the '+' operator should have the same essential type. The current types are: 'unsigned' and 'signed'.</p></div>
<div class="balloon" rel="6"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2506/" target="_blank">V2506</a> A function should have a single point of exit at the end.</p></div>
<div class="balloon" rel="16"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2571/" target="_blank">V2571</a> Pointer to void should not be converted to a pointer to object. Consider inspecting the first argument of the 'lock' function call.</p></div>
<div class="balloon" rel="22"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2571/" target="_blank">V2571</a> Pointer to void should not be converted to a pointer to object. Consider inspecting the first argument of the 'lock' function call.</p></div>
<div class="balloon" rel="46"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2571/" target="_blank">V2571</a> Pointer to void should not be converted to a pointer to object. Consider inspecting the expression: '(void * *) data'.</p></div>
<div class="balloon" rel="47"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2562/" target="_blank">V2562</a> Expressions with pointer type should not be used in the '+', '-', '+=' and '-=' operations.</p></div>
<div class="balloon" rel="48"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2568/" target="_blank">V2568</a> Both operands of the '+' operator should have the same essential type. The current types are: 'unsigned' and 'signed'.</p></div>
<div class="balloon" rel="50"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2571/" target="_blank">V2571</a> Pointer to void should not be converted to a pointer to object. Consider inspecting the first argument of the 'lock' function call.</p></div>
<div class="balloon" rel="40"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2571/" target="_blank">V2571</a> Pointer to void should not be converted to a pointer to object. Consider inspecting the first argument of the 'lock' function call.</p></div>
<div class="balloon" rel="72"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2571/" target="_blank">V2571</a> Pointer to void should not be converted to a pointer to object. Consider inspecting the expression: '(void * *) data'.</p></div>
<div class="balloon" rel="73"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2562/" target="_blank">V2562</a> Expressions with pointer type should not be used in the '+', '-', '+=' and '-=' operations.</p></div>
<div class="balloon" rel="59"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2506/" target="_blank">V2506</a> A function should have a single point of exit at the end.</p></div>
<div class="balloon" rel="76"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2571/" target="_blank">V2571</a> Pointer to void should not be converted to a pointer to object. Consider inspecting the first argument of the 'lock' function call.</p></div>
<div class="balloon" rel="70"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2571/" target="_blank">V2571</a> Pointer to void should not be converted to a pointer to object. Consider inspecting the first argument of the 'lock' function call.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
